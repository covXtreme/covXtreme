%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper,10pt]{article}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{natbib,upgreek,mathtools}
\usepackage{rotating, caption}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{cprotect}
\usepackage{color}
\usepackage{fullpage}
\usepackage{titlesec}
\usepackage{hyperref}
\newcommand{\sectionbreak}{\clearpage}
%\usepackage[nolists]{endfloat}
\setcounter{section}{-1}\input{Phil_Preamble.tex}

\begin{document}

\title{\textbf{Contour estimation using Penalised Piecewise Constant marginal and conditional extreme value models}}
\author{Emma Ross, David Randell, Philip Jonathan\thanks{Corresponding author. Email: {\tt philip.jonathan@shell.com}}}
\date{\today}
%\date{} %nodate
\maketitle
%-------------------------------------------------------------------------------

%-------------------------------------------------------------------------------
\begin{abstract}
	This report describes the Penalised Piecewise Constant (PPC) model and software for estimation of environmental design contours using the conditional extremes model of \cite{HffTwn04}. The sample is composed of peaks over threshold values for both a conditioning variate and its \emph{associated} conditioned variate. Each pair is allocated to a particular \emph{covariate bin}; all pairs with the same covariate bin are assumed to have common extreme value characteristics. The non-stationary marginal extreme value characteristics of each variate as estimated using roughness-penalised maximum likelihood estimation using a generalised Pareto (GP) model. The extremal dependence structure between the variates on a transformed standard Gumbel scale is then estimated using a stationary conditional extremes model. Different approaches to contour estimation, generally reliant on simulation under the fitted models, are outlined.
\end{abstract}

%
\tableofcontents

\listoffigures

\section{Introduction}
%
The conditional extremes model of \cite{HffTwn04} (HT), and extensions such as \cite{JntEwnRnd14}, \cite{KefPpsTan13} provide a framework to estimate multivariate extremal dependence in the presence of covariates, and hence to estimate design contours and other statistics of interest in metocean design. The approach is motivated by an asymptotic form for the limiting conditional distribution of one or more conditioned random variables given a large value of a conditioning variable. An outline of the approach is given by \cite{JntFlnEwn10}. Conditions for the asymptotic argument to hold have been explored by \cite{HffRsn07}.

Suppose we want to estimate design contours using the conditional extremes model for bivariate peaks over threshold of random variables $\dot{Y}_1$ and $\dot{Y}_2$. These variables might be significant wave height $H_S$ and associated peak period $T_P$, and the dependence between them might be non-stationary with respect to covariates $\boldsymbol{X}$ such as season or storm direction. We then want to simulate realisations under the model, and use the simulation to estimate design contours. We propagate uncertainties due to tuning parameter choice (specifically, threshold levels for marginal and dependence models) and sampling throughout the inference, so that design contours reflect these.

Non-stationary with respect to covariates $\boldsymbol{X}$ is captured in the model using a Penalized Piecewise Constant (PPC) approach. Namely, directional covariates are split into bins considered to be roughly homogeneous. Model parameters are then estimated as constants within each bin. To avoid over-fitting, a penalty on the parameter difference between bins can be imposed, e.g. for the Generalised Pareto scale. An appropriate value for this roughness penalty is estimated using k-fold cross validation. Other parameters such as the rate of concurrence and threshold are simply estimated independently per bin.
\\
Overview: 5 stages which should be run in order. 
\begin{enumerate}
\item The first stage deals with finding or simulating storm peaks. Peaks are chosen using the main (conditioning) variable $\dot{Y}_1$. $\dot{Y}_2$ is then the associated value at the time of the storm peak in $\dot{Y}_1$. This is discussed in section \ref{Sec:Stg1}.
\item Secondly the user splits the data into bins based on the marginal response characteristics. This is discussed in section \ref{Sec:Stg2}.
\item The non stationary marginal models for the distribution of $\dot{Y}_1$ and $\dot{Y}_2$ are then fitted using penalised piecewise constant (PPC). These models are used to transform response data on the original scale, $\{\dot{y}_{1i},\dot{y}_{2i}\}_{i=1}^{N}$, to data on the Gumbel scale, $\{y_{i1},y_{2i}\}_{i=1}^{N}$. Details of this step are discussed in section \ref{Sec:Stg3}.
\item We then fit a conditional extremes model for $Y_2|Y_1$ for various choices of threshold for the conditioning variate, retaining the estimated model parameters and residuals. This is discussed in section \ref{Sec:Stg4}.
\item Finally, we estimate design contours. Using the output from the marginal and conditions extremes models, Monte Carlo simulations are run and contours drawn using various methods \ref{Sec:Stg5}.
\end{enumerate}
%-------------------------------------------------------------------------------
\section{Stage 1: Data preparation}  \label{Sec:Stg1}
\input{Stage1_Guide.tex}
%-------------------------------------------------------------------------------
\section{Stage 2: Choose covariate bins} \label{Sec:Stg2}
\input{Stage2_Guide.tex}
%-------------------------------------------------------------------------------
\section{Stage 3: Fit marginal PPC models} \label{Sec:Stg3}
\input{Stage3_Guide.tex}
%-------------------------------------------------------------------------------
\section{Stage 4: Fit conditional extremes model} \label{Sec:Stg4}
\input{Stage4_Guide.tex}
%-------------------------------------------------------------------------------
\section{Stage 5: Draw contours} \label{Sec:Stg5}
\input{Stage5_Guide.tex}


%\section{Case studies}
%\input{Case_studies.tex}
%-------------------------------------------------------------------------------
%\section{Discussion}
%\input{Discussion.tex}
%
%%-------------------------------------------------------------------------------
\appendix
\input{Appendix.tex}

%-------------------------------------------------------------------------------
\bibliographystyle{plainnat}
\bibliography{phil}
%-------------------------------------------------------------------------------

%-------------------------------------------------------------------------------
\end{document}
%-------------------------------------------------------------------------------

